<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>esp32学习应用 | zhan's blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">esp32学习应用</h1><a id="logo" href="/.">zhan's blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">esp32学习应用</h1><div class="post-meta">Aug 11, 2019<span> | </span><span class="category"><a href="/categories/esp32/">esp32</a></span></div><div class="post-content"><p><strong>esp32学习记录,主要是无线模块的应用</strong></p>
<a id="more"></a>
<p>使用前先安装好arduino IDE，<br>（1）去esp32官网上，找到github地址，将github里的关于esp32资源包下载来<br>（2）或是通过arduino的扩展包功能直接将包下载下来</p>
<p><em>推荐第二种，自己下载包后配置会出现不可名状的问题</em></p>
<p>插上开发板后，选择自己的板子。可以先通过例子程序进行练习。</p>
<h2 id="串口的使用"><a href="#串口的使用" class="headerlink" title="串口的使用"></a>串口的使用</h2><p>GPIO0，GPIO1是串口0（uart0）只有这个能烧程序<br>GPIO9，GPIO10是串口1（uart1）  </p>
<p><img src="esp32%E5%AD%A6%E4%B9%A0%E5%BA%94%E7%94%A8/Snipaste_2019-08-09_13-41-54.png" alt><br><img src="/imgs/2019-08-11/Snipaste_2019-08-09_13-41-54.png" alt></p>
<h2 id="AP功能"><a href="#AP功能" class="headerlink" title="AP功能"></a>AP功能</h2><p>esp32已经封装好了各种用途的包，直接引用就行</p>
<p><strong>#include &lt;WiFi.h&gt;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;WiFi.h&gt;</span><br><span class="line">IPAddress local_IP(192,168,4,22);//IP地址</span><br><span class="line">IPAddress gateway(192,168,4,22);//网关</span><br><span class="line">IPAddress subnet(255,255,255,0);//子网掩码</span><br><span class="line"></span><br><span class="line">const char *ssid = &quot;ESP32_AP_TEST&quot;;//网络名称</span><br><span class="line">const char *password = &quot;12345678&quot;;//网络密码</span><br><span class="line"></span><br><span class="line">void setup()</span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(115200);</span><br><span class="line">  Serial.println();</span><br><span class="line">  </span><br><span class="line">  WiFi.mode(WIFI_AP); //设置工作在AP模式</span><br><span class="line"></span><br><span class="line">  WiFi.softAPConfig(local_IP, gateway, subnet); //设置AP地址</span><br><span class="line">  while(!WiFi.softAP(ssid, password))&#123;&#125;; //启动AP</span><br><span class="line">  Serial.println(&quot;AP启动成功&quot;);</span><br><span class="line"></span><br><span class="line">  Serial.print(&quot;IP address: &quot;);</span><br><span class="line">  Serial.println(WiFi.softAPIP()); // 打印IP地址</span><br><span class="line"></span><br><span class="line">  WiFi.softAPsetHostname(&quot;myHostName&quot;); //设置主机名</span><br><span class="line">  Serial.print(&quot;HostName: &quot;);</span><br><span class="line">  Serial.println(WiFi.softAPgetHostname()); //打印主机名</span><br><span class="line"></span><br><span class="line">  Serial.print(&quot;mac Address: &quot;);</span><br><span class="line">  Serial.println(WiFi.softAPmacAddress()); //打印mac地址</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void loop()</span><br><span class="line">&#123;</span><br><span class="line">  delay(1000);</span><br><span class="line">  Serial.println(WiFi.softAPgetStationNum()); //打印客户端连接数</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="esp32%E5%AD%A6%E4%B9%A0%E5%BA%94%E7%94%A8/2019-08-11_13-40-49.png" alt><br><img src="/imgs/2019-08-11/2019-08-11_13-40-49.png" alt></p>
<p><img src="esp32%E5%AD%A6%E4%B9%A0%E5%BA%94%E7%94%A8/2019-08-11_13-42-02.png" alt><br><img src="/imgs/2019-08-11/2019-08-11_13-42-02.png" alt></p>
<p><strong>AP模式就像手机开启热点模式一般，让其他设备接入它<br>STA模式就是手机连上wifi一般</strong></p>
<h2 id="STA功能"><a href="#STA功能" class="headerlink" title="STA功能"></a>STA功能</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;WiFi.h&gt;</span><br><span class="line">const char *ssid = &quot;@PHICOMM_A0&quot;; //你的网络名称</span><br><span class="line">const char *password = &quot;1234567890@&quot;; //你的网络密码</span><br><span class="line">void setup()</span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(115200);</span><br><span class="line">  Serial.println();</span><br><span class="line"></span><br><span class="line">  WiFi.begin(ssid, password); //连接网络</span><br><span class="line"></span><br><span class="line">  while (WiFi.status() != WL_CONNECTED) //等待网络连接成功</span><br><span class="line">  &#123;</span><br><span class="line">    delay(500);</span><br><span class="line">    Serial.print(&quot;.&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(&quot;WiFi connected!&quot;);</span><br><span class="line"></span><br><span class="line">  Serial.println(&quot;IP address: &quot;);</span><br><span class="line">  Serial.println(WiFi.localIP()); //打印模块IP</span><br><span class="line">&#125;</span><br><span class="line">void loop()</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="esp32%E5%AD%A6%E4%B9%A0%E5%BA%94%E7%94%A8/2019-08-11_13-50-01.png" alt><br><img src="/imgs/2019-08-11/2019-08-11_13-50-01.png" alt></p>
<p><code>wl_status_t status()</code><br>返回联网状态，状态如下：<br>255：<code>WL_NO_SHIELD</code>不用在意（兼容WiFi Shield而设计）<br>0：<code>WL_IDLE_STATUS</code>正在WiFi工作模式间切换；<br>1：<code>WL_NO_SSID_AVAIL</code>无法访问设置的SSID网络；<br>2：<code>WL_SCAN_COMPLETED</code>扫描完成；<br>3：<code>WL_CONNECTED</code>连接成功；<br>4：<code>WL_CONNECT_FAILED</code>连接失败；<br>5：<code>WL_CONNECTION_LOST</code>丢失连接；<br>6：<code>WL_DISCONNECTED</code>断开连接；  </p>
<h2 id="扫描网络功能"><a href="#扫描网络功能" class="headerlink" title="扫描网络功能"></a>扫描网络功能</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;WiFi.h&gt;</span><br><span class="line">void setup()</span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(115200);</span><br><span class="line">  Serial.println();</span><br><span class="line"></span><br><span class="line">  WiFi.mode(WIFI_STA); //设置为STA模式</span><br><span class="line">  WiFi.disconnect();   //断开当前可能的连接</span><br><span class="line">  delay(100);</span><br><span class="line"></span><br><span class="line">  Serial.println(&quot;scan start&quot;);</span><br><span class="line">  int n = WiFi.scanNetworks(); //扫描并返回搜索到的网络数量，该方法默认会阻塞</span><br><span class="line">  Serial.println(&quot;scan done&quot;);</span><br><span class="line">  if (n != 0)</span><br><span class="line">  &#123;</span><br><span class="line">    Serial.print(n);</span><br><span class="line">    Serial.println(&quot; networks found&quot;);</span><br><span class="line">    for (int i = 0; i &lt; n; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">      Serial.println();</span><br><span class="line">      Serial.print(i + 1);</span><br><span class="line">      Serial.print(&quot;:       &quot;);</span><br><span class="line">      Serial.print(WiFi.SSID(i)); //打印网络名称</span><br><span class="line">      Serial.print(&quot;        &quot;);</span><br><span class="line">      Serial.print(WiFi.RSSI(i)); //打印信号强度</span><br><span class="line">      Serial.print(&quot;        &quot;);</span><br><span class="line">      Serial.print((WiFi.encryptionType(i) == WIFI_AUTH_OPEN) ? &quot;未加密&quot; : &quot;加密&quot;); //打印是否加密</span><br><span class="line">      delay(10);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">void loop()</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="esp32%E5%AD%A6%E4%B9%A0%E5%BA%94%E7%94%A8/2019-08-11_13-58-21.png" alt><br><img src="/imgs/2019-08-11/2019-08-11_13-58-21.png" alt></p>
<p>其中<code>WiFi.scanNetworks()</code>这个方法默认是同步搜索，可填入第一个参数，使其异步操作，不会带来阻塞<br><img src="esp32%E5%AD%A6%E4%B9%A0%E5%BA%94%E7%94%A8/2019-08-11_14-05-23.png" alt><br><img src="/imgs/2019-08-11/2019-08-11_14-05-23.png" alt></p>
<blockquote>
<p>int16_t <code>scanNetworks</code>(bool <code>async</code> = false, bool <code>show_hidden</code> = false, bool <code>passive</code> = false, uint32_t <code>max_ms_per_chan</code> = 300)<br>启动搜索，各项参数如下：<br><code>async</code>：异步扫描，该值为true时将启动异步扫描，该方法将不阻塞；<br><code>show_hidden</code>：是否扫描不广播的网络；<br>passive：影响扫描速度，该值为true时扫描速度较快（不确定）；<br><code>max_ms_per_chan</code>：每通道扫描时间；<br><code>int16_t scanComplete()</code><br>异步模式下用于获取扫描到的网络数量，如果返回值为-1，表示还在进行扫描，如果返回值为-1，表示未进行扫描或扫描失败；<br><code>void scanDelete()</code><br>删除内存中的扫描结果；<br><code>String SSID(uint8_t networkItem)</code><br>返回扫描到的网络名称；<br><code>wifi_auth_mode_t encryptionType(uint8_t networkItem)</code><br>返回扫描到的网络加密类型；<br><code>int32_t RSSI(uint8_t networkItem)</code><br>返回扫描到的网络信号强度；<br><code>int32_t channel(uint8_t networkItem)</code><br>返回扫描到的网络信道号；  </p>
</blockquote>
<h2 id="UDP功能"><a href="#UDP功能" class="headerlink" title="UDP功能"></a>UDP功能</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;WiFi.h&gt;</span><br><span class="line">#include &lt;WiFiUdp.h&gt; //引用以使用UDP</span><br><span class="line"></span><br><span class="line">const char *ssid = &quot;********&quot;;</span><br><span class="line">const char *password = &quot;********&quot;;</span><br><span class="line"></span><br><span class="line">WiFiUDP Udp;                      //创建UDP对象</span><br><span class="line">unsigned int localUdpPort = 2333; //本地端口号</span><br><span class="line"></span><br><span class="line">void setup()</span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(115200);</span><br><span class="line">  Serial.println();</span><br><span class="line"></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  while (!WiFi.isConnected())</span><br><span class="line">  &#123;</span><br><span class="line">    delay(500);</span><br><span class="line">    Serial.print(&quot;.&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(&quot;Connected&quot;);</span><br><span class="line">  Serial.print(&quot;IP Address:&quot;);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"></span><br><span class="line">  Udp.begin(localUdpPort); //启用UDP监听以接收数据</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void loop()</span><br><span class="line">&#123;</span><br><span class="line">  int packetSize = Udp.parsePacket(); //获取当前队首数据包长度</span><br><span class="line">  if (packetSize)                     //如果有数据可用</span><br><span class="line">  &#123;</span><br><span class="line">    char buf[packetSize];</span><br><span class="line">    Udp.read(buf, packetSize); //读取当前包数据</span><br><span class="line"></span><br><span class="line">    Serial.println();</span><br><span class="line">    Serial.print(&quot;Received: &quot;);</span><br><span class="line">    Serial.println(buf);</span><br><span class="line">    Serial.print(&quot;From IP: &quot;);</span><br><span class="line">    Serial.println(Udp.remoteIP());</span><br><span class="line">    Serial.print(&quot;From Port: &quot;);</span><br><span class="line">    Serial.println(Udp.remotePort());</span><br><span class="line"></span><br><span class="line">    Udp.beginPacket(Udp.remoteIP(), Udp.remotePort()); //准备发送数据</span><br><span class="line">    Udp.print(&quot;Received: &quot;);    //复制数据到发送缓存</span><br><span class="line">    Udp.write((const uint8_t*)buf, packetSize); //复制数据到发送缓存</span><br><span class="line">    Udp.endPacket();            //发送数据</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="esp32%E5%AD%A6%E4%B9%A0%E5%BA%94%E7%94%A8/2019-08-11_14-22-50.png" alt><br><img src="/imgs/2019-08-11/2019-08-11_14-22-50.png" alt></p>
<h2 id="TCP功能"><a href="#TCP功能" class="headerlink" title="TCP功能"></a>TCP功能</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;WiFi.h&gt;</span><br><span class="line">const char *ssid = &quot;@PHICOMM_A0&quot;;</span><br><span class="line">const char *password = &quot;1234567890@&quot;;</span><br><span class="line">const IPAddress serverIP(10,10,10,100); //欲访问的地址</span><br><span class="line">uint16_t serverPort = 50037;         //服务器端口号</span><br><span class="line"></span><br><span class="line">WiFiClient client; //声明一个客户端对象，用于与服务器进行连接</span><br><span class="line"></span><br><span class="line">void setup()</span><br><span class="line">&#123;</span><br><span class="line">    Serial.begin(115200);</span><br><span class="line">    Serial.println();</span><br><span class="line"></span><br><span class="line">    WiFi.mode(WIFI_STA);</span><br><span class="line">    WiFi.setSleep(false); //关闭STA模式下wifi休眠，提高响应速度</span><br><span class="line">    WiFi.begin(ssid, password);</span><br><span class="line">    while (WiFi.status() != WL_CONNECTED)</span><br><span class="line">    &#123;</span><br><span class="line">        delay(500);</span><br><span class="line">        Serial.print(&quot;.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    Serial.println(&quot;Connected&quot;);</span><br><span class="line">    Serial.print(&quot;IP Address:&quot;);</span><br><span class="line">    Serial.println(WiFi.localIP());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void loop()</span><br><span class="line">&#123;</span><br><span class="line">    Serial.println(&quot;尝试访问服务器&quot;);</span><br><span class="line">    if (client.connect(serverIP, serverPort)) //尝试访问目标地址</span><br><span class="line">    &#123;</span><br><span class="line">        Serial.println(&quot;访问成功&quot;);</span><br><span class="line"></span><br><span class="line">        client.print(&quot;Hello world!&quot;);                    //向服务器发送数据</span><br><span class="line">        while (client.connected() || client.available()) //如果已连接或有收到的未读取的数据</span><br><span class="line">        &#123;</span><br><span class="line">            if (client.available()) //如果有数据可读取</span><br><span class="line">            &#123;</span><br><span class="line">                String line = client.readStringUntil(&apos;\n&apos;); //读取数据到换行符</span><br><span class="line">                Serial.print(&quot;读取到数据：&quot;);</span><br><span class="line">                Serial.println(line);</span><br><span class="line">                client.write(line.c_str()); //将收到的数据回发</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Serial.println(&quot;关闭当前连接&quot;);</span><br><span class="line">        client.stop(); //关闭客户端</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        Serial.println(&quot;访问失败&quot;);</span><br><span class="line">        client.stop(); //关闭客户端</span><br><span class="line">    &#125;</span><br><span class="line">    delay(5000);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="esp32%E5%AD%A6%E4%B9%A0%E5%BA%94%E7%94%A8/2019-08-11_14-27-19.png" alt><br><img src="/imgs/2019-08-11/2019-08-11_14-27-19.png" alt></p>
<h2 id="WEB-CLIENT"><a href="#WEB-CLIENT" class="headerlink" title="WEB_CLIENT"></a>WEB_CLIENT</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;WiFi.h&gt;</span><br><span class="line"></span><br><span class="line">const char *ssid = &quot;@PHICOMM_A0&quot;;</span><br><span class="line">const char *password = &quot;1234567890@&quot;;</span><br><span class="line"></span><br><span class="line">const char *host = &quot;www.example.com&quot;; //欲访问的域名</span><br><span class="line"></span><br><span class="line">void setup()</span><br><span class="line">&#123;</span><br><span class="line">    Serial.begin(115200);</span><br><span class="line">    Serial.println();</span><br><span class="line"></span><br><span class="line">    WiFi.mode(WIFI_STA);</span><br><span class="line">    WiFi.setSleep(false); //关闭STA模式下wifi休眠，提高响应速度</span><br><span class="line">    WiFi.begin(ssid, password);</span><br><span class="line">    while (WiFi.status() != WL_CONNECTED)</span><br><span class="line">    &#123;</span><br><span class="line">        delay(500);</span><br><span class="line">        Serial.print(&quot;.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    Serial.println(&quot;Connected&quot;);</span><br><span class="line">    Serial.print(&quot;IP Address:&quot;);</span><br><span class="line">    Serial.println(WiFi.localIP());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void loop()</span><br><span class="line">&#123;</span><br><span class="line">    WiFiClient client; //声明一个客户端对象，用于与服务器进行连接</span><br><span class="line"></span><br><span class="line">    Serial.println(&quot;尝试访问服务器&quot;);</span><br><span class="line">    if (client.connect(host, 80)) //80为一般网站的端口号</span><br><span class="line">    &#123;</span><br><span class="line">        Serial.println(&quot;访问成功&quot;);</span><br><span class="line"></span><br><span class="line">        //向服务器发送请求头，请求网页数据</span><br><span class="line">        //******作为WEB Client使用最核心的就是和WEB Server连接成功后发送相应的请求头请求数据******</span><br><span class="line">        //******WEB Server在收到请求头后返回对应的数据，比如返回网页、图片、文本等******</span><br><span class="line">        //******关于请求头可以参考之前的文章《从零开始的ESP8266探索（06）-使用Server功能搭建Web Server》******</span><br><span class="line">        client.print(String(&quot;GET /&quot;) + &quot; HTTP/1.1\r\n&quot; +</span><br><span class="line">                     &quot;Host: &quot; + host + &quot;\r\n&quot; +</span><br><span class="line">                     &quot;Connection: close\r\n&quot; +</span><br><span class="line">                     &quot;\r\n&quot;);</span><br><span class="line"></span><br><span class="line">        //以下代码将收到的网页数据按行打印输出</span><br><span class="line">        //如果是常见的WEB Client（浏览器）的话会将收到的html文件渲染成我们一般看到的网页</span><br><span class="line">        while (client.connected() || client.available()) //如果已连接或有收到的未读取的数据</span><br><span class="line">        &#123;</span><br><span class="line">            if (client.available()) //如果有数据可读取</span><br><span class="line">            &#123;</span><br><span class="line">                String line = client.readStringUntil(&apos;\n&apos;); //按行读取数据</span><br><span class="line">                Serial.println(line);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        client.stop(); //关闭当前连接</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        Serial.println(&quot;访问失败&quot;);</span><br><span class="line">        client.stop(); //关闭当前连接</span><br><span class="line">    &#125;</span><br><span class="line">    delay(10000);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="esp32%E5%AD%A6%E4%B9%A0%E5%BA%94%E7%94%A8/2019-08-11_14-32-33.png" alt><br><img src="/imgs/2019-08-11/2019-08-11_14-32-33.png" alt></p>
<h2 id="WEB-SERVER"><a href="#WEB-SERVER" class="headerlink" title="WEB_SERVER"></a>WEB_SERVER</h2><blockquote>
<p>WebServer简单点理解就是网页服务器，主要干的活就是用户访问链接的时候执行相应的动作，对于开发来说主要处理的就是注册链接并编写用户访问该链接时需要执行的操作。<br>使用步骤如下：<br>引入相应库<code>#include &lt;WebServer.h&gt;</code>；<br>声明WebServer对象并设置端口号，一般WebServer端口号使用80；<br>使用<code>on()</code>方法注册链接与回调函数；<br>使用<code>begin()</code>方法启动服务器进行请求监听；<br>使用<code>handleClient()</code>处理来自客户端的请求；</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;WiFi.h&gt;</span><br><span class="line">#include &lt;WebServer.h&gt; //引入相应库</span><br><span class="line"></span><br><span class="line">const char *ssid = &quot;@PHICOMM_A0&quot;;</span><br><span class="line">const char *password = &quot;1234567890@&quot;;</span><br><span class="line"></span><br><span class="line">WebServer server(80); //声明WebServer对象</span><br><span class="line"></span><br><span class="line">void handleRoot() //回调函数</span><br><span class="line">&#123;</span><br><span class="line">  server.send(200, &quot;text/plain&quot;, &quot;这是根页面&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void handleP1() //回调函数</span><br><span class="line">&#123;</span><br><span class="line">  server.send(200, &quot;text/plain&quot;, &quot;这是P1页面&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void setup()</span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(115200);</span><br><span class="line">  Serial.println();</span><br><span class="line"></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.setSleep(false);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  while (WiFi.status() != WL_CONNECTED)</span><br><span class="line">  &#123;</span><br><span class="line">    delay(500);</span><br><span class="line">    Serial.print(&quot;.&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(&quot;Connected&quot;);</span><br><span class="line">  Serial.print(&quot;IP Address:&quot;);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"></span><br><span class="line">  server.on(&quot;/&quot;, handleRoot); //注册链接&quot;/&quot;与对应回调函数</span><br><span class="line"></span><br><span class="line">  server.on(&quot;/p1&quot;, handleP1); //注册链接&quot;/p1&quot;与对应回调函数</span><br><span class="line"></span><br><span class="line">  server.on(&quot;/p2&quot;, []() &#123; //注册链接&quot;/p2&quot;，对应回调函数通过内联函数声明</span><br><span class="line">    server.send(200, &quot;text/plain&quot;, &quot;这是P2页面，由内联函数声明&quot;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  server.begin(); //启动服务器</span><br><span class="line">  Serial.println(&quot;Web server started&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void loop()</span><br><span class="line">&#123;</span><br><span class="line">  server.handleClient(); //处理来自客户端的请求</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="esp32%E5%AD%A6%E4%B9%A0%E5%BA%94%E7%94%A8/2019-08-11_18-03-43.png" alt><br><img src="/imgs/2019-08-11/2019-08-11_18-03-43.png" alt><br><img src="esp32%E5%AD%A6%E4%B9%A0%E5%BA%94%E7%94%A8/2019-08-11_18-04-58.png" alt><br><img src="/imgs/2019-08-11/2019-08-11_18-04-58.png" alt><br><img src="esp32%E5%AD%A6%E4%B9%A0%E5%BA%94%E7%94%A8/2019-08-11_18-07-11.png" alt><br><img src="/imgs/2019-08-11/2019-08-11_18-07-11.png" alt><br>网页的显示与浏览器的编码有关，第三张图显示的编码方式是UTF-8，其他的是改gb2312</p>
<h2 id="WEB-SERVER功能"><a href="#WEB-SERVER功能" class="headerlink" title="WEB_SERVER功能"></a>WEB_SERVER功能</h2><p>本次的打印机物联网打印机的后台设置就是基于这项功能实现的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;SD WebServer Test&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;p style=&quot;background-color:gray&quot;&gt;这是来自SD卡的html文件&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>先将这个html文件放入SD卡根目录下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;WiFi.h&gt;</span><br><span class="line">#include &lt;WebServer.h&gt;</span><br><span class="line">#include &lt;SD_MMC.h&gt;</span><br><span class="line"></span><br><span class="line">const char *ssid = &quot;********&quot;;</span><br><span class="line">const char *password = &quot;********&quot;;</span><br><span class="line"></span><br><span class="line">WebServer server(80); //声明WebServer对象</span><br><span class="line"></span><br><span class="line">void handleRoot() //回调函数</span><br><span class="line">&#123;</span><br><span class="line">  File contentFile = SD_MMC.open(&quot;/index.html&quot;); //从SD卡读取文件</span><br><span class="line">  if (!contentFile)</span><br><span class="line">  &#123;</span><br><span class="line">    Serial.println(&quot;读取文件失败&quot;);</span><br><span class="line">    server.send(404, &quot;text/plain&quot;, &quot;访问失败&quot;);</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line">  String contentType = &quot;text/html&quot;; //Content-Type</span><br><span class="line">  server.streamFile(contentFile, contentType); //向客户端发送文件</span><br><span class="line">  contentFile.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void setup()</span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(115200);</span><br><span class="line">  Serial.println();</span><br><span class="line"></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.setSleep(false);</span><br><span class="line">  WiFi.begin(ssid, password); //连接到无线网络</span><br><span class="line">  while (WiFi.status() != WL_CONNECTED)</span><br><span class="line">  &#123;</span><br><span class="line">    delay(500);</span><br><span class="line">    Serial.print(&quot;.&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(&quot;Connected&quot;);</span><br><span class="line">  Serial.print(&quot;IP Address:&quot;);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"></span><br><span class="line">  if (!SD_MMC.begin()) //挂载SD卡</span><br><span class="line">  &#123;</span><br><span class="line">    Serial.println(&quot;存储卡挂载失败&quot;);</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  server.on(&quot;/&quot;, handleRoot); //注册链接和回调函数</span><br><span class="line"></span><br><span class="line">  server.begin(); //启动Web服务器</span><br><span class="line">  Serial.println(&quot;Web服务器启动&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void loop()</span><br><span class="line">&#123;</span><br><span class="line">  server.handleClient(); //处理来自客户端的请求</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="esp32%E5%AD%A6%E4%B9%A0%E5%BA%94%E7%94%A8/2019-08-11_19-43-12.png" alt><br><img src="/imgs/2019-08-11/2019-08-11_19-43-12.png" alt></p>
</div><div class="tags"><a href="/tags/网络/">网络</a><a href="/tags/硬件/">硬件</a></div><div class="post-nav"><a class="pre" href="/2019/09/10/nodejs与微信小程序创建websocket连接/">nodejs与微信小程序创建websocket连接</a><a class="next" href="/2019/08/09/nodejs/">nodejs学习</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://yoursite.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/esp32/">esp32</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nodejs/">nodejs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/单片机/">单片机</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/物联网学习/">物联网学习</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/后端/" style="font-size: 15px;">后端</a> <a href="/tags/前端/" style="font-size: 15px;">前端</a> <a href="/tags/通信/" style="font-size: 15px;">通信</a> <a href="/tags/网络/" style="font-size: 15px;">网络</a> <a href="/tags/硬件/" style="font-size: 15px;">硬件</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/10/15/stm32学习/">stm32学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/20/nodejs操作mysql数据库，通过微信小程序/">nodejs操作mysql数据库，通过微信小程序</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/10/nodejs与微信小程序创建websocket连接/">nodejs与微信小程序创建websocket连接</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/11/esp32学习应用/">esp32学习应用</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/09/nodejs/">nodejs学习</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">zhan's blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"react":{"opacity":0.7},"log":false});</script></body></html>